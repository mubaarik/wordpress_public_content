AWPCP.define("campaign-manager/jquery-campaign-advertisement-position-content-form",["jquery"],function(a){var b=function(b){this.container=a(b),this.setup()};a.extend(b.prototype,{setup:function(){var a=this;a.form=a.container.find("form"),a.contentTypeOptions=a.container.find(".awpcp-advertisement-position-content-type-field"),a.uploadImageField=a.container.find(".awpcp-advertisement-position-upload-field"),a.customContentField=a.container.find(".awpcp-advertisement-position-content-field"),a.loadingIcon=a.container.find(".spinner"),a.setupPlugins(),a.showActiveField()},setupPlugins:function(){var b=this;b.contentTypeOptions.buttonset(),b.contentTypeOptions.find(":radio").change(function(){b.showActiveField()}),b.form.ajaxForm({beforeSubmit:function(){b.loadingIcon.addClass("is-visible-inline-block")},success:function(c){if(b.loadingIcon.removeClass("is-visible-inline-block"),"ok"===c.status){var d=a(c.html).find("form");b.container.find(".inside").html(d),b.setup()}else{var e=a('<div class="awpcp-error awpcp-inline-form-error">');a.each(c.errors,function(a,b){e.append(b+"</br>")}),b.form.append(e)}}})},showActiveField:function(){var a=this;"image"===a.contentTypeOptions.find(":checked").val()?(a.uploadImageField.show(),a.customContentField.hide()):(a.customContentField.show(),a.uploadImageField.hide())}}),a.fn.CampaignAdvertisementPositionContentForm=function(){return a(this).each(function(){a.noop(new b(a(this)))})}}),AWPCP.run("campaign-manager/manage-campaigns-admin-page",["jquery","awpcp/settings"],function(a,b){a(function(){var c=a("table.awpcp-campaigns");c.admin({actions:{remove:"awpcp-delete-campaign"},exclude:["edit"],ajaxurl:b.get("ajaxurl")})})}),AWPCP.run("campaign-manager/campaign-form",["jquery","awpcp/settings","awpcp/category-dropdown"],function(a,b){a(function(){var c,d;c=a("#awpcp-campaign-start-date").datepicker({dateFormat:b.get("date-format"),onSelect:function(a){d.datepicker("option","minDate",a)}}),d=a("#awpcp-campaign-end-date").datepicker({dateFormat:b.get("date-format")}),a(".awpcp-campaign-status").buttonset()}),a(function(){var c=a(".awpcp-campaign-sections");c.admin({actions:{add:"awpcp-add-campaign-section",edit:"awpcp-edit-campaign-section",remove:"awpcp-delete-campaign-section"},data:{campaign:parseInt(c.attr("campaign-id"),10)},ajaxurl:b.get("ajaxurl"),onFormReady:function(c,d){var e=d.find(".awpcp-campaign-section-pages-count-description"),f=d.find(".awpcp-campaign-section-positions"),g=d.find(".awpcp-campaign-section-form-spinner");d.find(".awpcp-category-dropdown").categorydropdown();var h=function(a,b){e.find(".awpcp-results-pages-count-placeholder").text(a.count),e.find(".awpcp-campaign-section-category-placeholder").text(b),e.show()},i=function(b){var c=f.find("li :checkbox");a.each(b.positions,function(b,d){var e=a('<input type="checkbox" name="positions[]">').val(b);c.is('[value="'+b+'"]:checked')&&(a.fn.prop?e.prop("checked",!0):e.attr("checked","checked")),f.append(a("<li>").append(a("<label>").text(d).prepend(e)))}),c.closest("li").remove()},j=function(c,e,f){if(null!==f){if(!a.contains(document,d[0]))return void a.unsubscribe("/category/updated",j);var k=e.find('[value="'+f+'"]').text();g.addClass("is-visible-inline-block"),a.getJSON(b.get("ajaxurl"),{action:"awpcp-get-campaign-section-configuration-options",category:f},function(a){"ok"===a.status&&(h(a,k),i(a)),g.removeClass("is-visible-inline-block")})}};a.subscribe("/category/updated",j)},onSuccess:function(b,c){a.publish("/campaign-section/updated",[c.attr("data-id")])}})})}),AWPCP.run("campaign-manager/campaign-form",["jquery","awpcp/settings","campaign-manager/jquery-campaign-advertisement-position-content-form"],function(a,b){a(function(){function c(b){var c=null,d=[];a.each(b,function(b,f){var g=a(f.form),h=e.find("#awpcp-advertisement-position-content-form-"+f.slug);0===h.length?(null===c?e.find(".awpcp-row").prepend(g):c.closest(".awpcp-one-half").after(g),c=g.CampaignAdvertisementPositionContentForm()):c=h,d.push(f.slug)}),e.find(".awpcp-advertisement-position-content-form").each(function(){var b=a(this);a.inArray(b.attr("position-slug"),d)===-1&&b.closest(".awpcp-one-half").remove()})}function d(){var d=e.find("> h3 > .spinner");d.addClass("is-visible-inline-block"),a.getJSON(b.get("ajaxurl"),{action:"awpcp-load-advertisement-positions-content-forms",campaign:e.attr("campaign-id")},function(a){d.removeClass("is-visible-inline-block"),"ok"===a.status&&c(a.forms)})}var e=a(".awpcp-campaign-content");e.find(".awpcp-advertisement-position-content-form").CampaignAdvertisementPositionContentForm(),a.subscribe("/campaign-section/updated",d)})});