AWPCP.define("awpcp/category-icons-manager",["jquery","knockout","awpcp/settings"],function(a,b,c){var d=function(d,e,f){function g(a,b,c){h.customIcons.push(h.processCustomIcon(c))}var h=this;h.selectedIcon=b.observable(e.selectedIcon),h.customIcons=b.observableArray(h.processCustomIcons(e.customIcons)),h.selectedIconUrl=b.computed(function(){var a,b,c=h.selectedIcon();return 0===c.indexOf("custom:")?(a=f.custom_icon_base_url,b=c.replace("custom:","")):(a=f.standard_icon_base_url,b=c.replace("standard:","")),b.length?a+b:""}),a.subscribe("/custom-icon/uploaded",g),h.onDeleteIconButtonClicked=function(b){b.isBeingModified(!0),a.post(c.get("ajaxurl"),{action:"awpcp-delete-custom-category-icon",filename:b.name},function(c){"ok"===c.status?(h.customIcons.remove(b),a.publish("/custom-icon/deleted",[b])):"error"===c.status&&a.publish("/messages/custom-icons-manager",{type:"error",content:c.errors.join(" ")}),b.isBeingModified(!1)})}};return a.extend(d.prototype,{processCustomIcons:function(b){return a.map(b,this.processCustomIcon)},processCustomIcon:function(a){return{id:a.id,name:a.name,url:a.url,isBeingModified:b.observable(!1)}}}),{init:function(a,c,e){var f=new d(a,c,e);return b.applyBindings(f,a),f}}}),AWPCP.define("awpcp/custom-category-icons-uploader",["jquery","awpcp/settings"],function(a,b){var c=Backbone.Model.extend({prepareUploader:function(a,c,d){var e=this;e.uploader=new plupload.Uploader({browse_button:d.get(0),url:b.get("ajaxurl"),container:a.get(0),drop_element:c.get(0),filters:{mime_types:[{title:"Custom Icons",extensions:"jpg,gif,png"}],prevent_duplicates:!0},multipart_params:{action:"awpcp-upload-custom-category-icon"},chunk_size:"10000000",runtimes:"html5,flash,silverlight,html4",multiple_queues:!0,flash_swf_url:e.get("settings").flash_swf_url,silverlight_xap_url:e.get("settings").silverlight_xap_url}),e.uploader.init(),e.uploader.bind("FilesAdded",e.onFilesAdded,e),e.uploader.bind("FileUploaded",e.onFileUplaoded,e)},onFilesAdded:function(a){a.start()},onFileUplaoded:function(b,c,d){var e=a.parseJSON(d.response);"ok"===e.status&&e.file?a.publish("/custom-icon/uploaded",[c,e.file]):"ok"!==e.status&&(c.status=plupload.FAILED,b.trigger("UploadProgress",c))}});return c}),AWPCP.run("awpcp/manage-category-icons",["jquery","knockout","awpcp/custom-category-icons-uploader","awpcp/category-icons-manager","awpcp/media-uploader-view","awpcp/settings","awpcp/jquery-messages"],function(a,b,c,d,e,f){a(function(){var b=a("#awpcp-manage-category-icons-form");if(b.length){var g=f.get("manage-category-icons-options"),h=f.get("category-icons-data"),i=new c({settings:g});a.noop(new e({el:a(".awpcp-media-uploader"),model:i})),d.init(b.find(".awpcp-category-icons-manager").get(0),h,g),b.find(".awpcp-manage-category-icons-tabs").tabs(),b.find(".awpcp-messages").appendTo(b.find(".awpcp-custom-icons.awpcp-tabs-panel")).AWPCPMessages()}})});