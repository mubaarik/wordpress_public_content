!function(a){var b={init:function(c){return this.each(function(){var d=this,e=a(d).empty();d.opt=a.extend(!0,{},a.fn.raty.defaults,c),e.data("settings",d.opt),d.opt.number=b.between(d.opt.number,0,20),"/"!=d.opt.path.substring(d.opt.path.length-1,d.opt.path.length)&&(d.opt.path+="/"),"function"==typeof d.opt.score&&(d.opt.score=d.opt.score.call(d)),d.opt.score&&(d.opt.score=b.between(d.opt.score,0,d.opt.number));for(var f=1;f<=d.opt.number;f++)a("<img />",{src:d.opt.path+(!d.opt.score||d.opt.score<f?d.opt.starOff:d.opt.starOn),alt:f,title:f<=d.opt.hints.length&&null!==d.opt.hints[f-1]?d.opt.hints[f-1]:f}).appendTo(d),d.opt.space&&e.append(f<d.opt.number?"&#160;":"");d.stars=e.children('img:not(".raty-cancel")'),d.score=a("<input />",{type:"hidden",name:d.opt.scoreName}).appendTo(d),d.opt.score&&d.opt.score>0&&(d.score.val(d.opt.score),b.roundStar.call(d,d.opt.score)),d.opt.iconRange&&b.fill.call(d,d.opt.score),b.setTarget.call(d,d.opt.score,d.opt.targetKeep);var g=d.opt.space?4:0,h=d.opt.width||d.opt.number*d.opt.size+d.opt.number*g;d.opt.cancel&&(d.cancel=a("<img />",{src:d.opt.path+d.opt.cancelOff,alt:"x",title:d.opt.cancelHint,"class":"raty-cancel"}),"left"==d.opt.cancelPlace?e.prepend("&#160;").prepend(d.cancel):e.append("&#160;").append(d.cancel),h+=d.opt.size+g),d.opt.readOnly?(b.fixHint.call(d),d.cancel&&d.cancel.hide()):(e.css("cursor","pointer"),b.bindAction.call(d)),e.css("width",h)})},between:function(a,b,c){return Math.min(Math.max(parseFloat(a),b),c)},bindAction:function(){var c=this,d=a(c);d.mouseleave(function(){var a=c.score.val()||void 0;b.initialize.call(c,a),b.setTarget.call(c,a,c.opt.targetKeep),c.opt.mouseover&&c.opt.mouseover.call(c,a)});var e=c.opt.half?"mousemove":"mouseover";c.opt.cancel&&c.cancel.mouseenter(function(){a(this).attr("src",c.opt.path+c.opt.cancelOn),c.stars.attr("src",c.opt.path+c.opt.starOff),b.setTarget.call(c,null,!0),c.opt.mouseover&&c.opt.mouseover.call(c,null)}).mouseleave(function(){a(this).attr("src",c.opt.path+c.opt.cancelOff),c.opt.mouseover&&c.opt.mouseover.call(c,c.score.val()||null)}).click(function(a){c.score.removeAttr("value"),c.opt.click&&c.opt.click.call(c,null,a)}),c.stars.bind(e,function(e){var f=parseInt(this.alt,10);if(c.opt.half){var g=parseFloat((e.pageX-a(this).offset().left)/c.opt.size),h=g>.5?1:.5;f=parseFloat(this.alt)-1+h,b.fill.call(c,f),c.opt.precision&&(f=f-h+g),b.showHalf.call(c,f)}else b.fill.call(c,f);d.data("score",f),b.setTarget.call(c,f,!0),c.opt.mouseover&&c.opt.mouseover.call(c,f,e)}).click(function(a){c.score.val(c.opt.half||c.opt.precision?d.data("score"):this.alt),c.opt.click&&c.opt.click.call(c,c.score.val(),a)})},cancel:function(c){return a(this).each(function(){var d=this,e=a(d);return e.data("readonly")===!0?this:(c?b.click.call(d,null):b.score.call(d,null),void d.score.removeAttr("value"))})},click:function(c){return a(this).each(function(){return a(this).data("readonly")===!0?this:(b.initialize.call(this,c),this.opt.click?this.opt.click.call(this,c):b.error.call(this,'you must add the "click: function(score, evt) { }" callback.'),void b.setTarget.call(this,c,!0))})},error:function(b){a(this).html(b),a.error(b)},fill:function(a){for(var b,c,d,e=this,f=e.stars.length,g=0,h=1;h<=f;h++)b=e.stars.eq(h-1),e.opt.iconRange&&e.opt.iconRange.length>g?(c=e.opt.iconRange[g],d=e.opt.single?h==a?c.on||e.opt.starOn:c.off||e.opt.starOff:h<=a?c.on||e.opt.starOn:c.off||e.opt.starOff,h<=c.range&&b.attr("src",e.opt.path+d),h==c.range&&g++):(d=e.opt.single?h==a?e.opt.starOn:e.opt.starOff:h<=a?e.opt.starOn:e.opt.starOff,b.attr("src",e.opt.path+d))},fixHint:function(){var b=a(this),c=parseInt(this.score.val(),10),d=this.opt.noRatedMsg;!isNaN(c)&&c>0&&(d=c<=this.opt.hints.length&&null!==this.opt.hints[c-1]?this.opt.hints[c-1]:c),b.data("readonly",!0).css("cursor","default").attr("title",d),this.score.attr("readonly","readonly"),this.stars.attr("title",d)},getScore:function(){var b,c=[];return a(this).each(function(){b=this.score.val(),c.push(b?parseFloat(b):void 0)}),c.length>1?c:c[0]},readOnly:function(c){return this.each(function(){var d=a(this);return d.data("readonly")===c?this:(this.cancel&&(c?this.cancel.hide():this.cancel.show()),c?(d.unbind(),d.children("img").unbind(),b.fixHint.call(this)):(b.bindAction.call(this),b.unfixHint.call(this)),void d.data("readonly",c))})},reload:function(){return b.set.call(this,{})},roundStar:function(a){var b=(a-Math.floor(a)).toFixed(2);if(b>this.opt.round.down){var c=this.opt.starOn;b<this.opt.round.up&&this.opt.halfShow?c=this.opt.starHalf:b<this.opt.round.full&&(c=this.opt.starOff),this.stars.eq(Math.ceil(a)-1).attr("src",this.opt.path+c)}},score:function(){return arguments.length?b.setScore.apply(this,arguments):b.getScore.call(this)},set:function(b){return this.each(function(){var c=a(this),d=c.data("settings"),e=c.clone().removeAttr("style").insertBefore(c);c.remove(),e.raty(a.extend(d,b))}),a(this.selector)},setScore:function(c){return a(this).each(function(){return a(this).data("readonly")===!0?this:(b.initialize.call(this,c),void b.setTarget.call(this,c,!0))})},setTarget:function(c,d){if(this.opt.target){var e=a(this.opt.target);0==e.length&&b.error.call(this,"target selector invalid or missing!");var f=c;f=d&&void 0!==f?"hint"==this.opt.targetType?null===f&&this.opt.cancel?this.opt.cancelHint:this.opt.hints[Math.ceil(f-1)]:this.opt.precision?parseFloat(f).toFixed(1):parseInt(f,10):this.opt.targetText,this.opt.targetFormat.indexOf("{score}")<0&&b.error.call(this,'template "{score}" missing!'),null!==c&&(f=this.opt.targetFormat.toString().replace("{score}",f)),e.is(":input")?e.val(f):e.html(f)}},showHalf:function(a){var b=(a-Math.floor(a)).toFixed(1);b>0&&b<.6&&this.stars.eq(Math.ceil(a)-1).attr("src",this.opt.path+this.opt.starHalf)},initialize:function(a){a=a?b.between(a,0,this.opt.number):0,b.fill.call(this,a),a>0&&(this.opt.halfShow&&b.roundStar.call(this,a),this.score.val(a))},unfixHint:function(){for(var b=0;b<this.opt.number;b++)this.stars.eq(b).attr("title",b<this.opt.hints.length&&null!==this.opt.hints[b]?this.opt.hints[b]:b);a(this).data("readonly",!1).css("cursor","pointer").removeAttr("title"),this.score.attr("readonly","readonly")}};a.fn.raty=function(c){return b[c]?b[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?void a.error("Method "+c+" does not exist!"):b.init.apply(this,arguments)},a.fn.raty.defaults={cancel:!1,cancelHint:"cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:void 0,half:!1,halfShow:!0,hints:["bad","poor","regular","good","gorgeous"],iconRange:void 0,mouseover:void 0,noRatedMsg:"not rated yet",number:5,path:"img/",precision:!1,round:{down:.25,full:.6,up:.76},readOnly:!1,score:void 0,scoreName:"score",single:!1,size:16,space:!0,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",target:void 0,targetFormat:"{score}",targetKeep:!1,targetText:"",targetType:"hint",width:void 0}}(jQuery),AWPCP.define("comments/comment",["jquery","awpcp/settings"],function(a,b){var c=function(b){this.element=a(b),this.id=parseInt(this.element.attr("data-comment-id"),10),this.init()};return a.extend(c.prototype,{init:function(){var c=this;this.element.delegate(".awpcp-comment-actions a","click",function(d){d.preventDefault();var e=a(this),f=e.closest("li").attr("class");a.getJSON(b.get("ajaxurl"),{id:c.id,action:"awpcp-comments-"+f+"-comment"},function(a){a.status&&"ok"===a.status?"edit"===f?c.show_edit_form(a):"delete"===f?c.show_delete_form(a):"flag"===f&&c.flag_comment(a):c.show_errors(a)})})},show_comment:function(b){var c=this,d=this.element.find(".awpcp-comment-container");c.form.remove(),d.replaceWith(a(b.html).find(".awpcp-comment-container")),c.remove_errors()},remove_comment:function(){this.element.remove()},flag_comment:function(){this.element.find("li.flag").fadeOut()},show_edit_form:function(c){var d=this,e=this.element.find(".awpcp-comment-container");d.form=a(c.html),d.form.appendTo(d.element).find("textarea").focus(),d.form.find(".cancel").click(function(){d.form.remove(),d.remove_errors(),e.show()}),d.form.ajaxForm({url:b.get("ajaxurl"),type:"post",dataType:"json",data:{action:"awpcp-comments-save-comment"},success:function(a){a.status&&"error"===a.status?d.show_errors(a):d.show_comment(a)}}),e.hide(),d.remove_errors()},show_delete_form:function(c){var d=this;d.form=a(c.html),d.form.appendTo(d.element),d.form.find(".cancel").click(function(){d.form.remove(),d.remove_errors()}),d.form.ajaxForm({url:b.get("ajaxurl"),type:"post",dataType:"json",data:{id:d.id,confirmed:!0,action:"awpcp-comments-delete-comment"},success:function(a){a.status&&"error"===a.status?d.show_errors(a):d.remove_comment(a)}}),d.remove_errors()},show_errors:function(b){var c=this;c.form&&c.form.parent().length?a.each(b.errors,function(a,b){c.element.append('<div class="awpcp-error">'+b+"</div>")}):a.each(b.errors,function(a,b){c.element.prepend('<div class="awpcp-error">'+b+"</div>")})},remove_errors:function(){this.element.find(".awpcp-error").remove()}}),c}),AWPCP.define("awpcp/jquery-ratings",["jquery","awpcp/settings","awpcp/localization","jquery-raty"],function(a,b,c){var d=function(d){var e=d.find(".awpcp-ad-rating-stars"),f=d.find(".awpcp-ad-rating-message"),g=d.find(".awpcp-ad-rating-count"),h=e.attr("data-images-base"),i=e.attr("data-rating");g.text(e.attr("data-count")),e.raty({cancel:!0,path:e.attr("data-images-path"),starHalf:h+"-half.png",starOff:h+"-off.png",starOn:h+"-on.png",readOnly:parseInt(e.attr("data-read-only"),10)>0,score:i,click:function(d){a.post(b.get("ajaxurl"),{action:null===d?"awpcp-ratings-delete":"awpcp-ratings-rate",ad:e.attr("data-ad-id"),rating:d},function(a){"ok"===a.status?(e.raty("score",a.rating),g.text(a.count),f.text(c.get("raty","thank-you-message")),i=d):(e.raty("score",i),f.text(c.get("raty","error-message")))},"json")},mouseover:function(a,b){"undefined"!=typeof b&&f.empty()}})};a.fn.ratings=function(){return a(this).each(function(){a.noop(new d(a(this)))})}}),AWPCP.run("comments-ratings/define-jquery-raty",["jquery"],function(a){a.isFunction(a.fn.raty)&&AWPCP.define("jquery-raty",["jquery"],function(){})}),AWPCP.run("comments-ratings/init-frontend",["jquery","comments/comment","awpcp/jquery-ratings"],function(a,b){a(function(){a(".awpcp-ad-rating").ratings(),a(".awpcp-comment").each(function(){a.noop(new b(a(this)))})})});